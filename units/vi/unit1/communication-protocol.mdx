# Giao Thá»©c Truyá»n ThÃ´ng

MCP Ä‘á»‹nh nghÄ©a má»™t giao thá»©c truyá»n thÃ´ng chuáº©n hÃ³a cho phÃ©p Client vÃ  Server trao Ä‘á»•i thÃ´ng Ä‘iá»‡p má»™t cÃ¡ch nháº¥t quÃ¡n, dá»… dá»± Ä‘oÃ¡n. Sá»± chuáº©n hÃ³a nÃ y ráº¥t quan trá»ng Ä‘á»ƒ Ä‘áº£m báº£o kháº£ nÄƒng tÆ°Æ¡ng tÃ¡c trong cá»™ng Ä‘á»“ng. Trong pháº§n nÃ y, chÃºng ta sáº½ khÃ¡m phÃ¡ cáº¥u trÃºc giao thá»©c vÃ  cÆ¡ cháº¿ váº­n chuyá»ƒn Ä‘Æ°á»£c sá»­ dá»¥ng trong MCP.

<Tip warning={true}>

ChÃºng ta Ä‘ang Ä‘i sÃ¢u vÃ o nhá»¯ng chi tiáº¿t phá»©c táº¡p cá»§a giao thá»©c MCP (nguyÃªn vÄƒn: "nitty-gritty" - chá»‰ nhá»¯ng chi tiáº¿t quan trá»ng vÃ  phá»©c táº¡p). Báº¡n khÃ´ng cáº§n biáº¿t táº¥t cáº£ nhá»¯ng Ä‘iá»u nÃ y Ä‘á»ƒ xÃ¢y dá»±ng vá»›i MCP, nhÆ°ng nÃªn biáº¿t vá» sá»± tá»“n táº¡i vÃ  cÃ¡ch hoáº¡t Ä‘á»™ng cá»§a nÃ³.

</Tip>

## JSON-RPC: Ná»n Táº£ng

Cá»‘t lÃµi cá»§a MCP sá»­ dá»¥ng **JSON-RPC 2.0** lÃ m Ä‘á»‹nh dáº¡ng thÃ´ng Ä‘iá»‡p cho má»i giao tiáº¿p giá»¯a Client vÃ  Server. JSON-RPC lÃ  giao thá»©c gá»i thá»§ tá»¥c tá»« xa nháº¹ Ä‘Æ°á»£c mÃ£ hÃ³a báº±ng JSON, mang láº¡i cÃ¡c Æ°u Ä‘iá»ƒm:

- Dá»… Ä‘á»c vÃ  dá»… gá»¡ lá»—i
- KhÃ´ng phá»¥ thuá»™c ngÃ´n ngá»¯, há»— trá»£ triá»ƒn khai trÃªn má»i mÃ´i trÆ°á»ng láº­p trÃ¬nh
- ÄÆ°á»£c thiáº¿t láº­p tá»‘t vá»›i Ä‘áº·c táº£ rÃµ rÃ ng vÃ  Ä‘Æ°á»£c Ã¡p dá»¥ng rá»™ng rÃ£i

![message types](https://huggingface.co/datasets/mcp-course/images/resolve/main/unit1/5.png)

Giao thá»©c Ä‘á»‹nh nghÄ©a ba loáº¡i thÃ´ng Ä‘iá»‡p:

### 1. YÃªu Cáº§u (Requests)

ÄÆ°á»£c gá»­i tá»« Client Ä‘áº¿n Server Ä‘á»ƒ khá»Ÿi táº¡o má»™t thao tÃ¡c. ThÃ´ng Ä‘iá»‡p YÃªu cáº§u bao gá»“m:
- Äá»‹nh danh duy nháº¥t (`id`)
- TÃªn phÆ°Æ¡ng thá»©c cáº§n gá»i (vÃ­ dá»¥: `tools/call`)
- Tham sá»‘ cho phÆ°Æ¡ng thá»©c (náº¿u cÃ³)

VÃ­ dá»¥ YÃªu cáº§u:

```json
{
  "jsonrpc": "2.0",
  "id": 1,
  "method": "tools/call",
  "params": {
    "name": "weather",
    "arguments": {
      "location": "San Francisco"
    }
  }
}
```

### 2. Pháº£n Há»“i (Responses)

ÄÆ°á»£c gá»­i tá»« Server Ä‘áº¿n Client Ä‘á»ƒ tráº£ lá»i YÃªu cáº§u. ThÃ´ng Ä‘iá»‡p Pháº£n há»“i bao gá»“m:
- `id` giá»‘ng vá»›i YÃªu cáº§u tÆ°Æ¡ng á»©ng
- Hoáº·c `result` (thÃ nh cÃ´ng) hoáº·c `error` (tháº¥t báº¡i)

VÃ­ dá»¥ Pháº£n há»“i ThÃ nh cÃ´ng:
```json
{
  "jsonrpc": "2.0",
  "id": 1,
  "result": {
    "temperature": 62,
    "conditions": "Partly cloudy"
  }
}
```

VÃ­ dá»¥ Pháº£n há»“i Lá»—i:
```json
{
  "jsonrpc": "2.0",
  "id": 1,
  "error": {
    "code": -32602,
    "message": "Invalid location parameter"
  }
}
```

### 3. ThÃ´ng BÃ¡o

ThÃ´ng Ä‘iá»‡p má»™t chiá»u khÃ´ng yÃªu cáº§u pháº£n há»“i. ThÆ°á»ng Ä‘Æ°á»£c gá»­i tá»« Server Ä‘áº¿n Client Ä‘á»ƒ cáº­p nháº­t tiáº¿n trÃ¬nh hoáº·c thÃ´ng bÃ¡o sá»± kiá»‡n.

VÃ­ dá»¥ ThÃ´ng BÃ¡o:
```json
{
  "jsonrpc": "2.0",
  "method": "progress",
  "params": {
    "message": "Processing data...",
    "percent": 50
  }
}
```

## CÆ¡ Cháº¿ Váº­n Chuyá»ƒn

JSON-RPC Ä‘á»‹nh nghÄ©a Ä‘á»‹nh dáº¡ng thÃ´ng Ä‘iá»‡p, nhÆ°ng MCP cÅ©ng chá»‰ Ä‘á»‹nh cÃ¡ch thá»©c cÃ¡c thÃ´ng Ä‘iá»‡p nÃ y Ä‘Æ°á»£c truyá»n táº£i giá»¯a Server Ä‘áº¿n Client. Hai cÆ¡ cháº¿ váº­n chuyá»ƒn chÃ­nh Ä‘Æ°á»£c há»— trá»£:

### stdio (Äáº§u vÃ o/Äáº§u ra chuáº©n)

CÆ¡ cháº¿ stdio Ä‘Æ°á»£c dÃ¹ng cho giao tiáº¿p cá»¥c bá»™, khi Client vÃ  Server cháº¡y trÃªn cÃ¹ng mÃ¡y:

á»¨ng dá»¥ng chá»§ khá»Ÿi cháº¡y Server nhÆ° má»™t tiáº¿n trÃ¬nh con vÃ  giao tiáº¿p báº±ng cÃ¡ch ghi vÃ o Ä‘áº§u vÃ o chuáº©n (stdin) vÃ  Ä‘á»c tá»« Ä‘áº§u ra chuáº©n (stdout).

<Tip>

**TrÆ°á»ng há»£p sá»­ dá»¥ng** cho phÆ°Æ¡ng thá»©c truyá»n táº£i nÃ y lÃ  cÃ¡c cÃ´ng cá»¥ local nhÆ° truy cáº­p há»‡ thá»‘ng file hoáº·c cháº¡y script local.

</Tip>

**Æ¯u Ä‘iá»ƒm** chÃ­nh cá»§a phÆ°Æ¡ng thá»©c nÃ y lÃ  Ä‘Æ¡n giáº£n, khÃ´ng yÃªu cáº§u cáº¥u hÃ¬nh máº¡ng vÃ  Ä‘Æ°á»£c há»‡ Ä‘iá»u hÃ nh cÃ¡ch ly an toÃ n.

### HTTP + SSE (Server-Sent Events) / HTTP cÃ³ thá»ƒ streaming

PhÆ°Æ¡ng thá»©c HTTP + SSE Ä‘Æ°á»£c dÃ¹ng cho giao tiáº¿p tá»« xa khi Client vÃ  Server cÃ³ thá»ƒ á»Ÿ cÃ¡c mÃ¡y khÃ¡c nhau:

Giao tiáº¿p diá»…n ra qua HTTP, vá»›i Server sá»­ dá»¥ng Server-Sent Events (SSE) Ä‘á»ƒ Ä‘áº©y cÃ¡c cáº­p nháº­t tá»›i Client qua káº¿t ná»‘i liÃªn tá»¥c.

<Tip>

**TrÆ°á»ng há»£p sá»­ dá»¥ng** cho phÆ°Æ¡ng thá»©c nÃ y lÃ  káº¿t ná»‘i tá»›i API tá»« xa, dá»‹ch vá»¥ Ä‘Ã¡m mÃ¢y hoáº·c tÃ i nguyÃªn dÃ¹ng chung.

</Tip>

**Æ¯u Ä‘iá»ƒm** chÃ­nh lÃ  hoáº¡t Ä‘á»™ng Ä‘Æ°á»£c qua máº¡ng, tÃ­ch há»£p Ä‘Æ°á»£c vá»›i dá»‹ch vá»¥ web vÃ  tÆ°Æ¡ng thÃ­ch vá»›i mÃ´i trÆ°á»ng serverless.

CÃ¡c báº£n cáº­p nháº­t gáº§n Ä‘Ã¢y cá»§a chuáº©n MCP Ä‘Ã£ giá»›i thiá»‡u hoáº·c cáº£i tiáº¿n "Streamable HTTP", mang láº¡i tÃ­nh linh hoáº¡t cao hÆ¡n báº±ng cÃ¡ch cho phÃ©p Server nÃ¢ng cáº¥p Ä‘á»™ng lÃªn SSE Ä‘á»ƒ streaming khi cáº§n, Ä‘á»“ng thá»i váº«n giá»¯ Ä‘Æ°á»£c tÃ­nh tÆ°Æ¡ng thÃ­ch vá»›i mÃ´i trÆ°á»ng serverless.

## VÃ²ng Ä‘á»i tÆ°Æ¡ng tÃ¡c

á» pháº§n trÆ°á»›c, chÃºng ta Ä‘Ã£ tháº£o luáº­n vá» vÃ²ng Ä‘á»i cá»§a má»™t lÆ°á»£t tÆ°Æ¡ng tÃ¡c Ä‘Æ¡n láº» giá»¯a Client (ğŸ’») vÃ  Server (ğŸŒ). Giá» hÃ£y xem xÃ©t vÃ²ng Ä‘á»i cá»§a má»™t lÆ°á»£t tÆ°Æ¡ng tÃ¡c hoÃ n chá»‰nh trong ngá»¯ cáº£nh giao thá»©c MCP.

Giao thá»©c MCP Ä‘á»‹nh nghÄ©a vÃ²ng Ä‘á»i tÆ°Æ¡ng tÃ¡c cÃ³ cáº¥u trÃºc giá»¯a Client vÃ  Server:

### Khá»Ÿi táº¡o

Client káº¿t ná»‘i tá»›i Server vÃ  hai bÃªn trao Ä‘á»•i phiÃªn báº£n giao thá»©c cÃ¹ng cÃ¡c tÃ­nh nÄƒng há»— trá»£, Server pháº£n há»“i vá»›i phiÃªn báº£n giao thá»©c vÃ  tÃ­nh nÄƒng mÃ  nÃ³ há»— trá»£.

<table style="width: 100%;">
  <tr>
    <td style="background-color: lightgreen; text-align: center; padding: 10px; border: 1px solid #ccc; border-radius: 4px;">ğŸ’»</td>
    <td style="text-align: center;">â†’<br>initialize</td>
    <td style="background-color: lightblue; text-align: center; padding: 10px; border: 1px solid #ccc; border-radius: 4px;">ğŸŒ</td>
  </tr>
  <tr>
    <td style="background-color: lightgreen; text-align: center; padding: 10px; border: 1px solid #ccc; border-radius: 4px;">ğŸ’»</td>
    <td style="text-align: center;">â†<br>response</td>
    <td style="background-color: lightblue; text-align: center; padding: 10px; border: 1px solid #ccc; border-radius: 4px;">ğŸŒ</td>
  </tr>
  <tr>
    <td style="background-color: lightgreen; text-align: center; padding: 10px; border: 1px solid #ccc; border-radius: 4px;">ğŸ’»</td>
    <td style="text-align: center;">â†’<br>initialized</td>
    <td style="background-color: lightblue; text-align: center; padding: 10px; border: 1px solid #ccc; border-radius: 4px;">ğŸŒ</td>
  </tr>
</table>

Client xÃ¡c nháº­n hoÃ n táº¥t khá»Ÿi táº¡o qua thÃ´ng bÃ¡o.

### KhÃ¡m phÃ¡

Client yÃªu cáº§u thÃ´ng tin vá» cÃ¡c tÃ­nh nÄƒng kháº£ dá»¥ng vÃ  Server pháº£n há»“i vá»›i danh sÃ¡ch cÃ´ng cá»¥ cÃ³ sáºµn.

<table style="width: 100%;">
  <tr>
    <td style="background-color: lightgreen; text-align: center; padding: 10px; border: 1px solid #ccc; border-radius: 4px;">ğŸ’»</td>
    <td style="text-align: center;">â†’<br>tools/list</td>
    <td style="background-color: lightblue; text-align: center; padding: 10px; border: 1px solid #ccc; border-radius: 4px;">ğŸŒ</td>
  </tr>
  <tr>
    <td style="background-color: lightgreen; text-align: center; padding: 10px; border: 1px solid #ccc; border-radius: 4px;">ğŸ’»</td>
    <td style="text-align: center;">â†<br>response</td>
    <td style="background-color: lightblue; text-align: center; padding: 10px; border: 1px solid #ccc; border-radius: 4px;">ğŸŒ</td>
  </tr>
</table>

QuÃ¡ trÃ¬nh nÃ y cÃ³ thá»ƒ Ä‘Æ°á»£c láº·p láº¡i cho tá»«ng cÃ´ng cá»¥, tÃ i nguyÃªn hoáº·c loáº¡i prompt.

### Thá»±c thi

Client kÃ­ch hoáº¡t cÃ¡c kháº£ nÄƒng dá»±a trÃªn nhu cáº§u cá»§a Host.

<table style="width: 100%;">
  <tr>
    <td style="background-color: lightgreen; text-align: center; padding: 10px; border: 1px solid #ccc; border-radius: 4px;">ğŸ’»</td>
    <td style="text-align: center;">â†’<br>tools/call</td>
    <td style="background-color: lightblue; text-align: center; padding: 10px; border: 1px solid #ccc; border-radius: 4px;">ğŸŒ</td>
  </tr>
  <tr>
    <td style="background-color: lightgreen; text-align: center; padding: 10px; border: 1px solid #ccc; border-radius: 4px;">ğŸ’»</td>
    <td style="text-align: center;">â†<br>thÃ´ng bÃ¡o (tiáº¿n trÃ¬nh tÃ¹y chá»n)</td>
    <td style="background-color: lightblue; text-align: center; padding: 10px; border: 1px solid #ccc; border-radius: 4px;">ğŸŒ</td>
  </tr>
  <tr>
    <td style="background-color: lightgreen; text-align: center; padding: 10px; border: 1px solid #ccc; border-radius: 4px;">ğŸ’»</td>
    <td style="text-align: center;">â†<br>pháº£n há»“i</td>
    <td style="background-color: lightblue; text-align: center; padding: 10px; border: 1px solid #ccc; border-radius: 4px;">ğŸŒ</td>
  </tr>
</table>

### Káº¿t thÃºc

Káº¿t ná»‘i Ä‘Æ°á»£c Ä‘Ã³ng má»™t cÃ¡ch há»£p lá»‡ khi khÃ´ng cÃ²n cáº§n thiáº¿t vÃ  Server xÃ¡c nháº­n yÃªu cáº§u táº¯t.

<table style="width: 100%;">
  <tr>
    <td style="background-color: lightgreen; text-align: center; padding: 10px; border: 1px solid #ccc; border-radius: 4px;">ğŸ’»</td>
    <td style="text-align: center;">â†’<br>táº¯t mÃ¡y</td>
    <td style="background-color: lightblue; text-align: center; padding: 10px; border: 1px solid #ccc; border-radius: 4px;">ğŸŒ</td>
  </tr>
  <tr>
    <td style="background-color: lightgreen; text-align: center; padding: 10px; border: 1px solid #ccc; border-radius: 4px;">ğŸ’»</td>
    <td style="text-align: center;">â†<br>pháº£n há»“i</td>
    <td style="background-color: lightblue; text-align: center; padding: 10px; border: 1px solid #ccc; border-radius: 4px;">ğŸŒ</td>
  </tr>
  <tr>
    <td style="background-color: lightgreen; text-align: center; padding: 10px; border: 1px solid #ccc; border-radius: 4px;">ğŸ’»</td>
    <td style="text-align: center;">â†’<br>thoÃ¡t</td>
    <td style="background-color: lightblue; text-align: center; padding: 10px; border: 1px solid #ccc; border-radius: 4px;">ğŸŒ</td>
  </tr>
</table>

Client gá»­i thÃ´ng Ä‘iá»‡p thoÃ¡t cuá»‘i cÃ¹ng Ä‘á»ƒ hoÃ n táº¥t viá»‡c káº¿t thÃºc.

## Tiáº¿n hÃ³a cá»§a Giao thá»©c

Giao thá»©c MCP Ä‘Æ°á»£c thiáº¿t káº¿ Ä‘á»ƒ cÃ³ thá»ƒ má»Ÿ rá»™ng vÃ  thÃ­ch á»©ng. Giai Ä‘oáº¡n khá»Ÿi táº¡o bao gá»“m thÆ°Æ¡ng lÆ°á»£ng phiÃªn báº£n, cho phÃ©p tÆ°Æ¡ng thÃ­ch ngÆ°á»£c khi giao thá»©c phÃ¡t triá»ƒn. BÃªn cáº¡nh Ä‘Ã³, viá»‡c khÃ¡m phÃ¡ kháº£ nÄƒng cho phÃ©p Client thÃ­ch á»©ng vá»›i cÃ¡c tÃ­nh nÄƒng cá»¥ thá»ƒ mÃ  má»—i Server cung cáº¥p, cho phÃ©p káº¿t há»£p cáº£ MÃ¡y chá»§ cÆ¡ báº£n vÃ  nÃ¢ng cao trong cÃ¹ng má»™t há»‡ sinh thÃ¡i.